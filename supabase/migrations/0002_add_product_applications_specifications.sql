-- =============================================================================
-- DY Carbon – Add Applications and Specifications to Products
-- 제품 등록 기능을 위한 스키마 확장
-- =============================================================================

-- -----------------------------------------------------------------------------
-- 변경 사유 (Why)
-- 제품 등록 화면에서 Applications(응용 분야)와 Specifications(스펙) 정보를
-- 저장할 수 있도록 products 테이블에 JSONB 컬럼을 추가합니다.
-- -----------------------------------------------------------------------------

-- -----------------------------------------------------------------------------
-- 영향도 평가 (Impact)
-- - products 테이블에 2개 컬럼 추가 (기존 데이터는 NULL 허용)
-- - 기존 제품 데이터에 영향 없음 (NULL 허용)
-- - RLS 정책은 기존과 동일하게 유지
-- -----------------------------------------------------------------------------

-- -----------------------------------------------------------------------------
-- 1. products 테이블에 applications, specifications 컬럼 추가
-- -----------------------------------------------------------------------------
ALTER TABLE public.products
  ADD COLUMN IF NOT EXISTS applications jsonb DEFAULT '[]'::jsonb,
  ADD COLUMN IF NOT EXISTS specifications jsonb DEFAULT '{}'::jsonb;

-- applications는 문자열 배열: ["응용1", "응용2", ...]
-- specifications는 객체: {"Density": {"value": "1.75", "unit": "g/cm³"}, ...}

-- -----------------------------------------------------------------------------
-- 2. updated_at 트리거가 이미 존재하므로 추가 작업 없음
-- -----------------------------------------------------------------------------

-- -----------------------------------------------------------------------------
-- 검증 쿼리 (Verification Query)
-- -----------------------------------------------------------------------------
-- SELECT column_name, data_type, is_nullable, column_default
-- FROM information_schema.columns
-- WHERE table_schema = 'public' AND table_name = 'products'
-- ORDER BY ordinal_position;

-- -----------------------------------------------------------------------------
-- 원복 SQL (Rollback SQL)
-- -----------------------------------------------------------------------------
-- ALTER TABLE public.products
--   DROP COLUMN IF EXISTS applications,
--   DROP COLUMN IF EXISTS specifications;
